# üî∑ Safira WAMGIA

![Vers√£o](https://img.shields.io/badge/Vers√£o-2025.04‚Äërev‚Äëstable-blue?style=flat-square)
![Licen√ßa](https://img.shields.io/badge/Licen√ßa-Particular-red?style=flat-square)
![Ambiente](https://img.shields.io/badge/Ambiente-Docker%20Compose-blueviolet?style=flat-square)
![Infra](https://img.shields.io/badge/Infraestrutura-Microsservi√ßos-orange?style=flat-square)

![Docker](https://img.shields.io/badge/Docker-24.x-2496ED?logo=docker&logoColor=white&style=flat-square)
![Python](https://img.shields.io/badge/Python-3.12-3776AB?logo=python&logoColor=white&style=flat-square)
![FastAPI](https://img.shields.io/badge/FastAPI-0.110-009688?logo=fastapi&logoColor=white&style=flat-square)
![n8n](https://img.shields.io/badge/n8n-Core-E85255?logo=n8n&logoColor=white&style=flat-square)
![WhatsApp](https://img.shields.io/badge/WhatsApp-Venom‚Äëbot-25D366?logo=whatsapp&logoColor=white&style=flat-square)


# üî∑ Safira WAMGIA ‚Äì README 2025

![Vers√£o](https://img.shields.io/badge/Vers%C3%A3o-2025.04%E2%80%91rev%E2%80%91stable-blue?style=flat-square)
![Licen√ßa](https://img.shields.io/badge/Licen%C3%A7a-Particular-red?style=flat-square)
![Ambiente](https://img.shields.io/badge/Ambiente-Docker%20Compose-blueviolet?style=flat-square)
![Infra](https://img.shields.io/badge/Infraestrutura-Microsservi%C3%A7os-orange?style=flat-square)

---

## üß† Vis√£o Geral

**Safira WAMGIA** √© uma assistente pessoal multimodal, executada localmente, com foco em privacidade, automa√ß√£o inteligente e intera√ß√µes emocionais atrav√©s de voz, texto e imagem. Baseada em **n8n**, **LLMs**, **STT/TTS**, e um conjunto de agentes espec√≠ficos, a Safira permite workflows personalizados e expans√£o modular.

---

## üß± Arquitetura Geral (Dockerized Stack)

A Safira opera via **Docker Compose**, utilizando 17 containers principais, separados por fun√ß√£o:

### üîπ Core e Intelig√™ncia
| Nome            | Fun√ß√£o                                 | Tags |
|------------------|-------------------------------------------|------|
| Safira-Core      | Motor principal dos fluxos n8n             | core |
| Whatsapp (Venom) | Integra√ß√£o via WhatsApp (entrada)         | comunicacao |
| LLM-Ollama       | Modelo LLM local (NLP e automa√ß√£o)         | llm, modelo |
| SESANE           | An√°lise emocional e contexto de voz         | modelo |

### üîâ Voz (Entrada e Sa√≠da)
| Nome     | Fun√ß√£o                                   | Tags |
|-----------|-----------------------------------------------|------|
| Whisper   | STT: Transcri√ß√£o de voz para texto             | output, audio |
| Coqui     | TTS: Convers√£o de texto para voz humanizada    | input, audio |

### üìä Administra√ß√£o e Observabilidade
| Nome        | Fun√ß√£o                          | Tags |
|-------------|----------------------------------|------|
| Prometheus  | Coleta de m√©tricas                 | admin |
| Grafana     | Dashboards e visualiza√ß√£o          | admin |
| Jira        | Gest√£o de tarefas e roadmap        | admin |
| Jenkins     | CI/CD e automa√ß√£o de deploy        | infra, admin |

### üåê Infraestrutura
| Nome     | Fun√ß√£o                                | Tags |
|----------|------------------------------------|------|
| Traefik  | Gateway reverso / proxy din√¢mico   | infra |
| NGINXS   | Webserver / roteamento interno     | infra |
| Redis    | Cache e mensagens leves            | infra |
| MinIO    | Armazenamento de objetos (S3-like) | infra |
| Postgree | Banco de dados principal           | infra, core |

### üñºÔ∏è Imagem (Input/Output)
| Nome               | Fun√ß√£o                                | Tags |
|--------------------|------------------------------------------|------|
| BLIP2              | Leitura e compreens√£o de imagens          | imagem, input |
| Stable Diffusion   | Gera√ß√£o de imagens via texto (T2I)       | imagem, output |

---

## üìÇ Estrutura do Reposit√≥rio

A estrutura de diret√≥rios da Safira √© organizada de forma modular e autogerada pelo script `run.sh`. Isso garante que todos os servi√ßos personalizados tenham seus arquivos essenciais criados dinamicamente, evitando falhas de build e facilitando onboarding.

```bash
safira-wamgia/
‚îú‚îÄ‚îÄ build/                    # Diret√≥rio base para todos os servi√ßos customizados
‚îÇ   ‚îú‚îÄ‚îÄ venom/                # Servi√ßo WhatsApp (venom-bot + main.js + Dockerfile)
‚îÇ   ‚îú‚îÄ‚îÄ ollama/               # LLM local (base: ollama)
‚îÇ   ‚îú‚îÄ‚îÄ sesame/               # Agente SESANE
‚îÇ   ‚îú‚îÄ‚îÄ whisper/              # STT via Faster-Whisper
‚îÇ   ‚îú‚îÄ‚îÄ coqui/                # TTS via Coqui TTS + Flask
‚îÇ   ‚îú‚îÄ‚îÄ blip2/                # Leitor de imagens com BLIP2
‚îÇ   ‚îú‚îÄ‚îÄ auto1111/             # Gera√ß√£o de imagem (Stable Diffusion)
‚îÇ   ‚îú‚îÄ‚îÄ jira/                 # Gest√£o de tarefas (base: Jira)
‚îÇ   ‚îú‚îÄ‚îÄ jenkins/              # Automa√ß√£o CI/CD (Jenkins)
‚îÇ   ‚îú‚îÄ‚îÄ prometheus/ grafana/  # Monitoramento
‚îÇ   ‚îú‚îÄ‚îÄ traefik/ 
‚îÇ   ‚îú‚îÄ‚îÄ nginxs/ 
‚îÇ   ‚îú‚îÄ‚îÄ redis/ 
‚îÇ   ‚îú‚îÄ‚îÄ minio/ 
‚îÇ   ‚îú‚îÄ‚îÄ postgres/
‚îú‚îÄ‚îÄ db/                       # Dados persistentes ou iniciais de banco (se usado)
‚îú‚îÄ‚îÄ docs/                     # Documenta√ß√£o do projeto (ex: MkDocs)
‚îú‚îÄ‚îÄ workflows/                # Fluxos, modelos e templates de fluxos de trabalho do n8n padr√£o.
‚îú‚îÄ‚îÄ scripts/                  # Scripts utilit√°rios: secrets.sh, release.sh, etc.
‚îú‚îÄ‚îÄ .env                      # Arquivo de vari√°veis de ambiente (gerado via run.sh)
‚îú‚îÄ‚îÄ .env.example              # Template base do .env
‚îú‚îÄ‚îÄ docker-compose.yml        # Orquestrador principal
‚îú‚îÄ‚îÄ run.sh                    # Script principal: cria tudo e sobe stack
```

### üß† Observa√ß√µes
- O `run.sh` cuida da cria√ß√£o dos arquivos `.py`, `Dockerfile`, `main.js` e `package.json` quando ausentes.
- Servi√ßos que exigem setup remoto (ex: Jira) exibir√£o uma mensagem de orienta√ß√£o no terminal.
- O reposit√≥rio foi projetado para funcionar de forma plug-and-play local, com baixa depend√™ncia de cloud e foco em autonomia.

---

## üõ†Ô∏è Setup Inicial

Todo o processo de prepara√ß√£o, configura√ß√£o e execu√ß√£o da stack Safira √© realizado exclusivamente atrav√©s do script `run.sh`. Esse script √© interativo, autodocumentado e modular, permitindo subir servi√ßos individualmente ou reiniciar a stack inteira com seguran√ßa.

### ‚úÖ O que o `run.sh` faz:
- Verifica se Docker e Docker Compose est√£o corretamente instalados
- Garante a exist√™ncia do arquivo `.env`, criando a partir do `.env.example` se necess√°rio
- Valida e solicita secrets ausentes (como senhas de Redis, Postgres, MinIO, etc.)
- Cria diret√≥rios essenciais e arquivos m√≠nimos para cada servi√ßo personalizado (como Venom, Coqui, Whisper, BLIP2, SESANE...)
- Clona reposit√≥rios base (ex: Stable Diffusion)
- Verifica se os Dockerfiles necess√°rios est√£o presentes e prontos
- Executa o `docker compose up -d --build`
- Exibe os principais endpoints acess√≠veis da plataforma

### üöÄ Como rodar:
1. Clone o reposit√≥rio e d√™ permiss√£o de execu√ß√£o ao script:

```bash
git clone https://github.com/caioross/Safira-WAMGIA.git
cd safira-wamgia
chmod +x run.sh
```

2. Inicie a stack:
```bash
./run.sh
```

### ‚öôÔ∏è Flags dispon√≠veis
Voc√™ pode usar o `run.sh` com par√¢metros adicionais:

| Comando               | Descri√ß√£o                                        |
|----------------------|--------------------------------------------------|
| `./run.sh`           | Sobe todos os servi√ßos com build autom√°tico     |
| `./run.sh --no-build`| Sobe servi√ßos sem recompilar imagens            |
| `./run.sh --reset`   | Derruba tudo, remove volumes e redes            |
| `./run.sh --status`  | Mostra status atual dos servi√ßos                |
| `./run.sh --only-core`| Sobe apenas n8n, WhatsApp, Postgres             |
| `./run.sh --only-ai` | Sobe somente os modelos IA (Whisper, Coqui etc) |

> üß† O `run.sh` √© seguro, modular e inteligente: roda s√≥ o necess√°rio, e nunca executa builds ou resets desnecess√°rios sem confirma√ß√£o.
bash
git clone https://github.com/caioross/Safira-WAMGIA.git
cd safira-wamgia
chmod +x setup.sh run.sh secrets.sh
./setup.sh
./secrets.sh
```

2. Suba os containers:

```bash
./run.sh up
```

---

## üåê Endpoints

Abaixo est√£o listados os principais endpoints HTTP expostos pelos servi√ßos da stack local. Essas portas s√£o mapeadas diretamente no `docker-compose.yml` e podem ser acessadas no navegador ou via API local.

| Componente           | Descri√ß√£o                                     | URL                                |
|----------------------|-----------------------------------------------|-------------------------------------|
| N8N Core             | Automa√ß√£o de fluxos (assistente principal)    | http://localhost:5678              |
| Venom API (WhatsApp) | Integra√ß√£o com WhatsApp via venom-bot         | http://localhost:3000              |
| LLM Ollama           | Modelo de linguagem local                     | http://localhost:11434             |
| SESANE               | An√°lise emocional de voz                      | http://localhost:8003              |
| Whisper STT          | Transcri√ß√£o de √°udio para texto               | http://localhost:9000              |
| Coqui TTS            | Gera√ß√£o de fala a partir de texto             | http://localhost:9001              |
| BLIP2                | Leitura e descri√ß√£o de imagens                | http://localhost:9003              |
| Stable Diffusion     | Gera√ß√£o de imagem via prompt textual          | http://localhost:7860              |
| Grafana              | Dashboards e visualiza√ß√£o de m√©tricas         | http://localhost:3001              |
| Prometheus           | Coletor de m√©tricas                           | http://localhost:9090              |
| Jenkins              | Pipeline CI/CD local                          | http://localhost:8083              |
| Jira                 | Gerenciamento de tarefas                      | http://localhost:8082              |
| Traefik              | Gateway reverso para servi√ßos HTTP            | http://localhost:8080              |
| NGINX                | Servidor de arquivos est√°ticos / conte√∫do     | http://localhost:8081              |
| MinIO Console        | Interface S3 para arquivos e objetos          | http://localhost:9002              |

| Componente Interno   | Descri√ß√£o                                     | Porta Interna                      |
|----------------------|-----------------------------------------------|-------------------------------------|
| PostgreSQL           | Banco de dados relacional                     | 5432                               |
| Redis                | Cache e pub/sub de mensagens                  | 6379                               |

> üí° Observa√ß√£o: Servi√ßos internos como PostgreSQL e Redis n√£o exp√µem interface web, mas s√£o essenciais para o funcionamento interno da stack. e Redis n√£o possuem interface HTTP, mas est√£o dispon√≠veis para conex√µes internas entre containers.

---

## üîê Secrets e Seguran√ßa

Execute `./secrets.sh` para gerar os secrets obrigat√≥rios. O script cobre:
- PostgreSQL, Redis, MinIO
- Tokens de API (Venom, Ollama, Supabase, etc)
- JWTs e secrets de aplica√ß√£o

---

## ‚ôªÔ∏è Ciclo CI/CD

| Branch             | Uso                             |
|--------------------|----------------------------------|
| `develop`          | Desenvolvimento ativo            |
| `release/x.y.z`    | Vers√£o candidata                |
| `main`             | Vers√£o est√°vel                   |

Scripts Bash automatizam o ciclo de releases:
- `./push-dev.sh` ‚Üí Sobe pra develop
- `./promote-release.sh 1.2.3` ‚Üí Cria release
- `./promote-main.sh 1.2.3` ‚Üí Sobe pro main com tag

---

## üìä Observabilidade

O m√≥dulo de observabilidade da Safira garante rastreamento completo da sa√∫de dos servi√ßos, an√°lise de performance e auditoria de eventos. Ele √© composto por:

### üìà Coleta de M√©tricas
- **Prometheus**: coleta dados de servi√ßos com suporte a `healthchecks`, uso de CPU, mem√≥ria, tempo de resposta, lat√™ncia de containers e servi√ßos expostos via Traefik ou FastAPI.
- **Exporters customizados** podem ser adicionados para servi√ßos espec√≠ficos como PostgreSQL ou Redis, para insights avan√ßados.

### üìä Visualiza√ß√£o e Dashboards
- **Grafana**: conectado ao Prometheus, apresenta dashboards em tempo real com:
  - Status de containers e recursos
  - M√©tricas de uso por servi√ßo (n8n, LLM, TTS/STT, etc.)
  - Uptime e erros de healthcheck
  - Tr√°fego do WhatsApp via Venom

> O painel default do Grafana est√° dispon√≠vel em `http://localhost:3000` com credenciais configuradas via `secrets.sh`

### ü™µ Logs Centralizados
- **Loki** (opcional): agrega e estrutura logs de todos os containers para an√°lise via Grafana (modo Explore).
- Logs podem ser filtrados por n√≠vel (`info`, `warning`, `error`) e por servi√ßo, √∫til para depura√ß√£o e auditoria de fluxos.

### üîî Alertas e Notifica√ß√µes (planejado)
- Integra√ß√£o futura com **Alertmanager** para notificar incidentes via e-mail, Telegram, Discord ou WhatsApp.

---

## üîç Roadmap

### ‚úÖ Conclu√≠dos
- [x] Integra√ß√£o com WhatsApp via Venom
- [x] Pipeline de CI/CD local com GitHub Actions + scripts
- [x] Convers√£o de voz para texto (Whisper) e TTS (Coqui)
- [x] Gera√ß√£o e leitura de imagens com IA (Stable Diffusion + BLIP2)
- [x] An√°lise emocional com SESANE
- [x] Dashboard de m√©tricas com Grafana + Prometheus
- [x] Secrets automatizados via `secrets.sh`
- [x] Setup completo com `run.sh`, `setup.sh`, `secrets.sh`

### üß™ Em Execu√ß√£o / Testes
- [ ] Testes unit√°rios automatizados por servi√ßo (pytest, ruff)
- [ ] Testes de stress e carga em Ollama e Whisper
- [ ] Teste de fallback de LLM secund√°ria (ex: GPT4All)
- [ ] Modo "dev" com auto-reload + debug isolado

### üß© A Fazer
- [ ] Caching inteligente com Redis para consultas repetidas
- [ ] Orquestra√ß√£o interna de agentes (modo LangChain-like)
- [ ] Documenta√ß√£o de uso para colaborador/analista
- [ ] Cria√ß√£o de perfil de execu√ß√£o leve (modo "m√≠nimo")
- [ ] Fallbacks para servi√ßos de voz (STT/TTS) em caso de falha
- [ ] Suporte a respostas multimodais nos fluxos n8n
- [ ] Modulariza√ß√£o do compose por perfil (admin/core/image/voz)
- [ ] Configura√ß√£o autom√°tica dos containers via script interativo (WIP)

> üìå Observa√ß√£o: O foco √© funcionalidade local, offline-friendly e com resili√™ncia total √† falta de cloud.
---

## üìÑ Licen√ßa

Este projeto √© **Particular**. Reprodu√ß√£o, distribui√ß√£o ou uso sem permiss√£o expressa est√° proibido.

‚ú® **Happy coding!**  
Equipe Safira WAMGIA üîÆüöÄ